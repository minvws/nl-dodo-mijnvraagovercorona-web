---
import type { HTMLAttributes } from 'astro/types';
import { Heading } from '@design-system/elements/Heading';
import type { PictureProps } from '../Picture';
import { Picture } from '../Picture';
import { Stack } from '../Layout/Stack';
import { Link } from '@design-system/elements/Link';
import { stringToSlug } from 'src/utilities/stringToSlug';

interface Props extends HTMLAttributes<'li'> {
	label: string;
	quote?: string;
	readMore?: string;
	readLess?: string;
	picture: PictureProps;
	headingLevel?: 1 | 2 | 3 | 4 | 5 | 6;
	headingStyledAs?: 1 | 2 | 3 | 4 | 5 | 6;
}

const {
	label,
	quote,
	readMore,
	readLess,
	picture,
	headingLevel = 3,
	headingStyledAs = 2,
	...attrs
} = Astro.props;
---

<li
	class="disclosure__item disclosure__item--campaign"
	data-module-bind="disclosure__item"
	{...attrs}
>
	<Stack>
		<Heading
			level={headingLevel}
			styledAs={headingStyledAs}
			class="disclosure__heading"
			itemprop="name"
			id={stringToSlug(label)}
		>
			{label}
		</Heading>
		{
			quote && picture ? (
				<div class="disclosure__item-wrap">
					{quote && <p class="c-tale-campaign__quote">{quote}</p>}
					{picture ? (
						<Picture class="c-tale-campaign__picture" {...picture} />
					) : null}
				</div>
			) : null
		}

		<Link
			id="disclosure-header-1"
			class={`disclosure__toggle--button disclosure__toggle--button-campaign`}
			aria-expanded="false"
			aria-controls="disclosure-panel-1"
			data-module-bind="disclosure__toggle"
			icon="chevron-small-down"
			iconPosition="trailing"
			data-pagefind-ignore="all"
		>
			<span class={readMore ? 'disclosure__show-inactive' : undefined}>
				{readMore}
			</span>
			<span class={readLess ? 'disclosure__show-active' : undefined}>
				{readLess}
			</span>
		</Link>
	</Stack>

	<div
		id="disclosure-panel-1"
		role="region"
		class="disclosure__panel"
		data-module-bind="disclosure__panel"
		aria-labelledby="disclosure-header-1"
		itemscope
		itemprop="acceptedAnswer"
		itemtype="https://schema.org/Answer"
	>
		<div
			class="disclosure__panel-inner"
			data-module-bind="disclosure__panel-inner"
			itemprop="text"
		>
			<slot />
		</div>
	</div>
</li>

<style lang="scss">
	@use '@mvoc/ui/styles/tools/a11y';
	@use '@mvoc/ui/styles/primitives/responsive';
	@use '@mvoc/ui/styles/tools/rem';

	.disclosure__panel {
		--_disclosure__panel-padding: var(
			--disclosure__panel-padding,
			var(--space-6)
		);
		--disclosure__panel--spacing: calc(
			var(--_disclosure__panel-padding) - var(--card-border-width)
		);
		block-size: 0;
		padding-inline: var(--disclosure__panel--spacing);
		overflow: hidden;
		opacity: 0;
		visibility: hidden;
		transition: all 0.3s ease-in-out;
	}

	.disclosure__panel-inner {
		padding-block-start: var(--space-4);
	}

	.disclosure__show-active {
		display: none;
	}

	.disclosure__item.is-active {
		.disclosure__panel {
			opacity: 1;
			visibility: visible;
		}
		.disclosure__show-inactive {
			display: none;
		}
		.disclosure__show-active {
			display: block;
		}
	}

	.disclosure__item--campaign {
		padding: #{rem.convert(24px)};
		background: #eef7fb;
		border-radius: var(--radii-nano);
		overflow: hidden;

		.disclosure__panel-inner {
			padding-block-end: var(--_disclosure__panel-padding);
		}

		.disclosure__toggle--button {
			display: flex;
			align-items: center;
			gap: var(--space-2);
			--button-color: var(--color-diepblauw);
			&:hover {
				--button-background-color: var(--color-poolblauw);
			}

			&:active {
				--button-border-color: var(--color-poolblauw);
			}

			:global(.e-icon) {
				transition: transform 0.3s;
			}

			&[aria-expanded='true'] {
				--button-background-color: var(--color-poolblauw);
				:global(.e-icon) {
					transform: rotate(180deg);
				}
			}
		}
		.disclosure__toggle--button-campaign {
			:global(.e-icon) {
				color: var(--color-accent-robijnrood);
			}
			:global(.e-link__label) {
				color: var(--color-accent-robijnrood);
			}
		}
		.disclosure__item-wrap {
			display: grid;
			grid-template-columns: 3fr 1fr;
			position: relative;
			gap: #{rem.convert(16px)};
		}
	}

	.c-tale-campaign__quote {
		font-style: italic;
		color: var(--color-diepblauw);
	}

	.c-tale-campaign__picture {
		position: absolute;
		right: 0;
		top: -25px;
		width: #{rem.convert(120px)};
		@media (--mq-large-until) {
			position: relative;
			right: -50px;
			top: -30px;
		}
	}
</style>
