---
import Layout from '@layouts/Layout.astro';
import {
	availableLocales,
	getLocaleFromURL,
	Locale,
} from 'src/utilities/locale/translation';
import {
	PageSituationQuestionProps,
	getDataSituationQuestions,
} from 'src/utilities/api';
import FormSwitch from '@modules/forms/situations/FormSwitch.astro';
import Heading from '@design-system/elements/typography/Heading.astro';

export async function getStaticPaths() {
	return await availableLocales.reduce(async (paths, locale) => {
		const collection = await getDataSituationQuestions({ locale });
		return [
			...(await paths),
			collection.pages.map((page) => ({
				params: { slug: page.slug, locale: locale.id },
				props: {
					pageData: page,
				},
			})),
		];
	}, Promise.resolve([]));
}

interface Props {
	pageData: PageSituationQuestionProps;
	locale: Locale;
}

const { pageData } = Astro.props;
const locale = getLocaleFromURL(Astro.url.pathname);
---

<Layout locale={locale} metaData={pageData.metaData}>
	<main>
		<Heading level={1}>{pageData.header.title}</Heading>
		<FormSwitch
			type={pageData.type}
			answersSingle={pageData.answersSingle}
			answersMultiple={pageData.answersMultiple}
			buttons={pageData.buttons}
		/>
	</main>
</Layout>
