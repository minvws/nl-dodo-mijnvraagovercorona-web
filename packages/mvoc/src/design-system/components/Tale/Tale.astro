---
import { Heading } from '@design-system/elements/Heading';
import { type Tale } from 'src/utilities/api/queries';
import { MultiContentBlock } from '../ContentBlock';
import { Switcher } from '../Layout/Grid';
import { Retain } from '../Layout/Retain';
import { Stack } from '../Layout/Stack';
import { Picture } from '../Picture';
import { stringToSlug } from 'src/utilities/stringToSlug';

interface Props extends Tale {
	anchorable?: boolean;
	renderTitle?: boolean;
	isCampaign?: boolean;
}

const {
	title,
	multiContentBlocks,
	picture,
	renderTitle = true,
	anchorable = true,
	isCampaign,
} = Astro.props;
---

<section class="c-tale" id={anchorable ? stringToSlug(title) : undefined}>
	<Switcher class="c-tale__switcher">
		<Retain variant={'text'}>
			<Stack class="c-tale__body">
				{renderTitle ? <Heading>{title}</Heading> : undefined}
				{
					multiContentBlocks ? (
						<MultiContentBlock multiContentBlocks={multiContentBlocks} />
					) : null
				}
			</Stack>
		</Retain>
		{
			picture && !isCampaign ? (
				<Picture class="c-tale__picture" {...picture} />
			) : null
		}
	</Switcher>
</section>

<style lang="scss">
	@use '@mvoc/ui/styles/tools/rem';
	@use '@mvoc/ui/styles/tools/list';

	.c-tale {
		&:nth-of-type(even) {
			.c-tale__switcher {
				flex-direction: row-reverse;
			}
		}
	}

	.c-tale__body {
		:global(:where(h1, h2, h3, h4, h5, h6, .e-heading)) {
			--heading-font-size: var(--font-size-delta);
			--heading-line-height: var(--line-height-delta);
		}
	}

	.c-tale__picture {
		:global(img) {
			inline-size: 100%;
			max-inline-size: #{rem.convert(280px)};
			margin-inline: auto;
		}
	}
</style>
