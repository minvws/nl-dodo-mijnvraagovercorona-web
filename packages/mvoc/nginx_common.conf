root /app;
listen  8080;

location /status {
  stub_status on;
  access_log   off;
  allow 127.0.0.1;
  deny all;
}

error_page 404 @error404;
location @error404 {
    rewrite ^\/(nl|en) /$1/404 last;
    rewrite ^ /en/404 last;
}

error_page 500 502 503 504 /50x.html;
location = /50x.html {
  internal;
}

# Cache HTML files
location / {
    absolute_redirect off;
    expires 5m;
    include "/opt/bitnami/nginx/conf/nginx_headers.conf";
    add_header Cache-Control "no-cache, public";

    # Remove trailing slash
    rewrite ^/(.*)/$ /$1 permanent;

    # jouw-situatie to home
    rewrite ^\/(nl|en)\/jouw-situatie$ /$1 permanent;
    # advies/ik-wil-meer-weten... -> tip/ik-wil-meer-weten...
    rewrite ^\/(nl|en)\/advies\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-de-tweede-helft-van-september$ /$1/tip/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-half-september permanent;
    # mag-ik-al-weer-een-prik -> kan-ik-een-herhaal-prik-halen
    rewrite ^\/(nl|en)\/mag-ik-al-weer-een-prik$ /$1/kan-ik-een-herhaal-prik-halen permanent;
    # landing herhaalprik redirect naar adviespagina
    rewrite ^\/(nl|en)\/kan-ik-een-herhaal-prik-halen$ /$1/advies/herhaalprik-ik-kan-een-herhaalprik-halen permanent;
    # advies terugreis naar china terugreis
    rewrite ^\/(nl|en)\/advies/plan-je-terug-reis-naar-nederland$ /$1/advies/plan-je-terug-reis-van-china-naar-nederland permanent;
    # advies terugreis naar china -> reis naar nl
    rewrite ^\/(nl|en)\/advies\/plan-je-terug-reis-van-china-naar-nederland$ /$1/advies/plan-je-reis-naar-nederland permanent;

    # new structure
    # thema/prikken -> vaccineren
    rewrite ^\/nl\/thema\/prikken$ /nl/vaccineren permanent;
    rewrite ^\/en\/thema\/prikken$ /en/vaccinating permanent;
    # TAAL/thema/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/thema\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/advies/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/advies\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/tip/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/tip\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/situatie/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/situatie\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;

    # /prikkenzonderafspraak -> /nl/vaccineren/prikkenzonderafspraak
    rewrite ^\/prikkenzonderafspraak$ /nl/vaccineren/prikken-zonder-afspraak permanent;
    # /over-vaccineren -> /nl/vaccineren
    rewrite ^\/over-vaccineren$ /nl/vaccineren permanent;

    # Redirects afschalen (10-03-2023)
    # permanent
    rewrite ^\/(nl|en)\/advies\/ik-heb-corona-met-klachten /$1/advies/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/negatief-getest-met-klachten /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/herhaalprik-ik-kan-een-herhaalprik-halen /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad permanent;
    rewrite ^\/(nl|en)\/advies\/coronaprik-zonder-afspraak /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-corona-zonder-klachten /$1/advies/s2-a6-ik-heb-een-positieve-corona-zelftest-zonder-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-andere-klachten-dan-corona /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-klachten-maar-ik-heb-niet-getest /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-en-heb-klachten /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-positieve-uitslag-van-een-zelftest /$1/situatie/s2-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl|en)\/advies\/ggd-ik-heb-klachten-die-passen-bij-corona /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-klachten-die-passen-bij-corona /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-ga-mensen-ontmoeten-met-een-kwetsbare-gezondheid /$1/situatie/s7-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-zonder-klachten /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-zonder-klachten /$1/advies/s7-a18-ik-ga-naar-iemand-met-een-kwetsbare-gezondheid permanent;
    rewrite ^\/(nl|en)\/tip\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-half-september /$1/tip/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona permanent;

    # temporary
    rewrite ^\/(nl|en)\/advies\/vaccineren-met-afspraak /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad redirect;

    # Gebruikerstest (20-06-2023)
    # Permanent
    rewrite ^\/(nl|en)\/thema\/isoleren /$1 permanent;
    rewrite ^\/(nl)\/thema\/vaccineren /$1/vaccineren permanent;
    rewrite ^\/(en)\/thema\/vaccineren /$1/vaccinating permanent;
    rewrite ^\/(nl)\/thema\/testen /$1/zelftesten-en-klachten permanent;
    rewrite ^\/(en)\/thema\/testen /$1/self-test-and-complaints permanent;
    rewrite ^\/(en)\/reizen /$1/travelling permanent;

    # batch 1
    rewrite ^\/(nl)\/s1-v1-heb-je-een-van-deze-klachten /$1/zelftesten-en-klachten/s1-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(en)\/s1-v1-heb-je-een-van-deze-klachten /$1/self-test-and-complaints/s1-v1-symptoms permanent;
    rewrite ^\/(nl)\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona /$1/vaccineren/alles-over-de-herhaalprik permanent;
    rewrite ^\/(en)\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona /$1/vaccinating/all-about-the-repeat-vaccination permanent;
    rewrite ^\/(nl)\/t6-veelgestelde-vragen-over-post-covid /$1/post-covid/t6-veelgestelde-vragen-over-post-covid permanent;
    rewrite ^\/(en)\/t6-veelgestelde-vragen-over-post-covid /$1/post-covid/t6-veelgestelde-vragen-over-post-covid permanent;
    rewrite ^\/(nl)\/s6-a16-ik-heb-een-kwetsbare-gezondheid /$1/kwetsbare-gezondheid/s6-a16-ik-heb-een-kwetsbare-gezondheid permanent;
    rewrite ^\/(en)\/s6-a16-ik-heb-een-kwetsbare-gezondheid /$1/vulnerable-health/s6-a16-ik-heb-een-kwetsbare-gezondheid permanent;
    rewrite ^\/(nl)\/s2-v1-is-je-zelftest-positief /$1/zelftesten-en-klachten/s2-v1-is-je-zelftest-positief permanent;
    rewrite ^\/(en)\/s2-v1-is-je-zelftest-positief /$1/self-test-and-complaints/s2-v1-is-your-self-test-positive permanent;
    rewrite ^\/(nl)\/s7-v1-heb-je-een-van-deze-klachten /$1/kwetsbare-gezondheid/s7-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(en)\/s7-v1-heb-je-een-van-deze-klachten /$1/vulnerable-health/s7-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl)\/s10-a19-ik-heb-een-corona-herstelbewijs-nodig /$1/reizen/s10-a19-ik-heb-een-corona-herstelbewijs-nodig permanent;
    rewrite ^\/(en)\/s10-a19-ik-heb-een-corona-herstelbewijs-nodig /$1/travelling/s10-a19-ik-heb-een-corona-herstelbewijs-nodig permanent;
    rewrite ^\/(nl)\/plan-je-reis-naar-nederland /$1/reizen/plan-je-reis-naar-nederland permanent;
    rewrite ^\/(en)\/plan-je-reis-naar-nederland /$1/travelling/plan-je-reis-naar-nederland permanent;
    rewrite ^\/(nl)\/plan-je-heenreis /$1/reizen/plan-je-heenreis permanent;
    rewrite ^\/(en)\/plan-je-heenreis /$1/travelling/plan-je-heenreis permanent;
    rewrite ^\/(nl)\/ik-heb-een-testuitslag-nodig-voor-een-reis /$1/reizen/ik-heb-een-negatieve-testuitslag-nodig-voor-een-reis permanent;
    rewrite ^\/(en)\/ik-heb-een-testuitslag-nodig-voor-een-reis /$1/travelling/i-need-a-negative-test-result-for-a-trip permanent;
    rewrite ^\/(nl)\/wat-betekent-de-actuele-situatie-in-china-voor-nederland /$1/reizen permanent;
    rewrite ^\/(en)\/wat-betekent-de-actuele-situatie-in-china-voor-nederland /$1/travelling permanent;

    # batch 2
    rewrite ^\/(nl)\/s1-v2-ben-je-ziek /$1/zelftesten-en-klachten/s1-v2-ben-je-ziek permanent;
    rewrite ^\/(en)\/s1-v2-ben-je-ziek /$1/self-test-and-complaints/s1-v2-ben-je-ziek permanent;
    rewrite ^\/(nl)\/s2-v3-ben-je-ziek /$1/zelftesten-en-klachten/s2-v3-ben-je-ziek permanent;
    rewrite ^\/(en)\/s2-v3-ben-je-ziek /$1/self-test-and-complaints/s2-v3-ben-je-ziek permanent;
    rewrite ^\/(nl)\/s4-v4-heb-je-de-basisserie-gehad /$1/zelftesten-en-klachten/s4-v4-heb-je-de-basisserie-gehad;
    rewrite ^\/(en)\/s4-v4-heb-je-de-basisserie-gehad /$1/self-test-and-complaints/s4-v4-completed-basic-series permanent;
    rewrite ^\/(nl)\/s4-v5-heb-je-een-herhaalprik-gehad /$1/zelftesten-en-klachten/s4-v5-heb-je-een-herhaalprik-gehad permanent;
    rewrite ^\/(en)\/s4-v5-heb-je-een-herhaalprik-gehad /$1/self-test-and-complaints/s4-v5-heb-je-een-herhaalprik-gehad permanent;
    rewrite ^\/(nl)\/s4-v5-heb-je-een-herhaalprik-gehad /$1/zelftesten-en-klachten/s4-v5-heb-je-een-herhaalprik-gehad permanent;
    rewrite ^\/(en)\/s4-v5-heb-je-een-herhaalprik-gehad /$1/self-test-and-complaints/s4-v5-heb-je-een-herhaalprik-gehad permanent;

    #batch 3
    rewrite ^\/(nl)\/s1-a1-ik-ben-ziek-en-heb-luchtwegklachten /$1/zelftesten-en-klachten/s1-a1-ik-ben-ziek-en-heb-luchtwegklachten permanent;
    rewrite ^\/(en)\/s1-a1-ik-ben-ziek-en-heb-luchtwegklachten /$1/self-test-and-complaints/s1-a1-ik-ben-ziek-en-heb-luchtwegklachten permanent;
    rewrite ^\/(nl)\/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten /$1/zelftesten-en-klachten/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(en)\/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten /$1/self-test-and-complaints/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachtenpermanent;
    rewrite ^\/(nl)\/s1-a3-ik-heb-geen-luchtwegklachten /$1/zelftesten-en-klachten/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(en)\/s1-a3-ik-heb-geen-luchtwegklachten/$1/self-test-and-complaints/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl)\/s2-v2-heb-je-een-van-deze-klachten /$1/zelftesten-en-klachten/s2-v2-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(en)\/s2-v2-heb-je-een-van-deze-klachten /$1/self-test-and-complaints/s2-v2-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl)\/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten /$1/zelftesten-en-klachten/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten permanent;
    rewrite ^\/(en)\/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten /$1/self-test-and-complaints/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten permanent;
    rewrite ^\/(nl)\/s2-a4-ik-ben-ziek-heb-luchtwegklachten-en-een-positieve-corona-zelftest /$1/zelftesten-en-klachten/s2-a4-ik-ben-ziek-heb-luchtwegklachten-en-een-positieve-corona-zelftest permanent;
    rewrite ^\/(en)\/s2-a4-ik-ben-ziek-heb-luchtwegklachten-en-een-positieve-corona-zelftest /$1/self-test-and-complaints/s2-a4-ik-ben-ziek-heb-luchtwegklachten-en-een-positieve-corona-zelftest permanent;

    # redirects oude urls (2023-06-22)
    rewrite ^\/(nl)\/positieve-test-heb-je-klachten-die-bij-corona-passen /$1/zelftesten-en-klachten/s2-v2-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl)\/positieve-test-sinds-wanneer-heb-je-last-van-deze-klachten /$1/zelftesten-en-klachten/s2-v2-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl)\/mijn-test-is-positief /$1/zelftesten-en-klachten/s2-v2-heb-je-een-van-deze-klachten permanent;

    try_files $uri $uri.html $uri/index.html =404;
}

# Cache static files
location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff2|svg)$ {
    expires 365d;
    include "/opt/bitnami/nginx/conf/nginx_headers.conf";
    add_header Cache-Control "public, no-transform";
}
