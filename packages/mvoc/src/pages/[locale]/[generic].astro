---
import Layout from '../../layouts/Layout.astro';
import { availableLocales, Locale } from 'src/utilities/locale/translation';
import { GenericPageProps, getDataGenericPages } from 'src/utilities/api';
import { Hero } from '@design-system/components/Hero';
import { Retain } from '@design-system/components/Layout/Retain';
import { ContentBlock } from '@design-system/components/ContentBlock';
import { Layer } from '@design-system/components/Layout/Layer';
import { Sidebar } from '@design-system/components/Layout/Sidebar';
import { CardPrivacy } from '@design-system/components/Card';
import { Stack } from '@design-system/components/Layout/Stack';

export async function getStaticPaths() {
	const collection = await getDataGenericPages();
	return collection.map((page: GenericPageProps) => ({
		params: { generic: page.slug, locale: page.localeID },
		props: {
			pageData: page,
			locale: availableLocales.filter(
				(locale) => locale.id === page.localeID,
			)[0],
		},
	}));
}

interface Props {
	pageData: GenericPageProps;
	locale: Locale;
}

const { pageData, locale } = Astro.props;
---

<Layout
	locale={locale}
	metaData={pageData.metaData}
	alternativeTranslations={pageData.alternatives}
>
	<Hero
		title={pageData.hero.title}
		chapeau={pageData.hero.chapeau}
		image={pageData.hero.image}
	>
		<ContentBlock value={pageData.hero.content} />
	</Hero>
	<Layer>
		<Retain>
			<Sidebar>
				<Retain variant="text">
					<Stack gap="small">
						<ContentBlock value={pageData.content} />
					</Stack>
				</Retain>
				<CardPrivacy slot="aside" />
			</Sidebar>
		</Retain>
	</Layer>
</Layout>
