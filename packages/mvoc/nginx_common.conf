root /app;
listen  8080;

location /status {
  stub_status on;
  access_log   off;
  allow 127.0.0.1;
  deny all;
}

error_page 404 @error404;
location @error404 {
    rewrite ^\/(nl|en) /$1/404 last;
    rewrite ^ /nl/404 last;
}

error_page 500 502 503 504 /50x.html;
location = /50x.html {
  internal;
}

# Cache HTML files
location / {
    absolute_redirect off;
    expires 5m;
    include "/opt/bitnami/nginx/conf/nginx_headers.conf";
    add_header Cache-Control "no-cache, public";

    # Remove trailing slash
    rewrite ^/(.*)/$ /$1 permanent;

    # jouw-situatie to home
    rewrite ^\/(nl|en)\/jouw-situatie$ /$1 permanent;
    # advies/ik-wil-meer-weten... -> tip/ik-wil-meer-weten...
    rewrite ^\/(nl|en)\/advies\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-de-tweede-helft-van-september$ /$1/tip/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-half-september permanent;
    # mag-ik-al-weer-een-prik -> kan-ik-een-herhaal-prik-halen
    rewrite ^\/(nl|en)\/mag-ik-al-weer-een-prik$ /$1/kan-ik-een-herhaal-prik-halen permanent;
    # landing herhaalprik redirect naar adviespagina
    rewrite ^\/(nl|en)\/kan-ik-een-herhaal-prik-halen$ /$1/advies/herhaalprik-ik-kan-een-herhaalprik-halen permanent;
    # advies terugreis naar china terugreis
    rewrite ^\/(nl|en)\/advies/plan-je-terug-reis-naar-nederland$ /$1/advies/plan-je-terug-reis-van-china-naar-nederland permanent;
    # advies terugreis naar china -> reis naar nl
    rewrite ^\/(nl|en)\/advies\/plan-je-terug-reis-van-china-naar-nederland$ /$1/advies/plan-je-reis-naar-nederland permanent;

    # new structure
    # thema/prikken -> vaccineren
    rewrite ^\/nl\/thema\/prikken$ /nl/vaccineren permanent;
    rewrite ^\/en\/thema\/prikken$ /en/vaccinating permanent;
    # TAAL/thema/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/thema\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/advies/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/advies\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/tip/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/tip\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;
    # TAAL/situatie/SLUG -> TAAL/SLUG
    rewrite ^\/(nl|en)\/situatie\/([a-zA-Z0-9-]+)$ /$1/$2 permanent;

    # /prikkenzonderafspraak -> /nl/vaccineren/prikkenzonderafspraak
    rewrite ^\/prikkenzonderafspraak$ /nl/vaccineren/prikken-zonder-afspraak permanent;

    # Redirects afschalen (10-03-2023)
    # permanent
    rewrite ^\/(nl|en)\/advies\/ik-heb-corona-met-klachten /$1/advies/s2-a5-ik-heb-een-positieve-corona-zelftest-en-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/negatief-getest-met-klachten /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/herhaalprik-ik-kan-een-herhaalprik-halen /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad permanent;
    rewrite ^\/(nl|en)\/advies\/coronaprik-zonder-afspraak /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-corona-zonder-klachten /$1/advies/s2-a6-ik-heb-een-positieve-corona-zelftest-zonder-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-andere-klachten-dan-corona /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-klachten-maar-ik-heb-niet-getest /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-en-heb-klachten /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-positieve-uitslag-van-een-zelftest /$1/situatie/s2-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl|en)\/advies\/ggd-ik-heb-klachten-die-passen-bij-corona /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-klachten-die-passen-bij-corona /$1/advies/s1-a2-ik-ben-niet-ziek-maar-heb-wel-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-ga-mensen-ontmoeten-met-een-kwetsbare-gezondheid /$1/situatie/s7-v1-heb-je-een-van-deze-klachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-zonder-klachten /$1/advies/s1-a3-ik-heb-geen-luchtwegklachten permanent;
    rewrite ^\/(nl|en)\/advies\/ik-heb-een-negatieve-testuitslag-zonder-klachten /$1/advies/s7-a18-ik-ga-naar-iemand-met-een-kwetsbare-gezondheid permanent;
    rewrite ^\/(nl|en)\/tip\/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona-vanaf-half-september /$1/tip/ik-wil-meer-weten-over-de-herhaalprik-tegen-corona permanent;

    # temporary
    rewrite ^\/(nl|en)\/advies\/vaccineren-met-afspraak /$1/situatie/s4-v3-heb-je-de-afgelopen-3-maanden-een-coronabesmetting-of-coronaprik-gehad redirect;
    rewrite ^\/(nl|en)\/thema\/vaccineren /$1 redirect;
    rewrite ^\/(nl|en)\/thema\/testen /$1 redirect;
    rewrite ^\/(nl|en)\/thema\/isoleren /$1 redirect;


    try_files $uri $uri.html $uri/index.html =404;
}

# Cache static files
location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff2|svg)$ {
    expires 365d;
    include "/opt/bitnami/nginx/conf/nginx_headers.conf";
    add_header Cache-Control "public, no-transform";
}
