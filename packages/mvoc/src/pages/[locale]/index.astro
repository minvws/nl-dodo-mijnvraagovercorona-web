---
import Layout from '../../layouts/Layout.astro';
import {
	availableLocales,
	Locale,
	prefixUrlWithlocale,
} from 'src/utilities/locale/translation';
import { getDataHome, PageHomeProps } from 'src/utilities/api';
import { Hero } from '@design-system/components/Hero';
import { Layer } from '@design-system/components/Layout/Layer';
import { Retain } from '@design-system/components/Layout/Retain';
import { Stack } from '@design-system/components/Layout/Stack';
import { SectionHeadingGroup } from '@design-system/components/SectionHeadingGroup';
import { ContentBlock } from '@design-system/components/ContentBlock';
import { GridFluid } from '@design-system/components/Layout/Grid';
import { Button } from '@design-system/elements/Button';
import { stringToSlug } from 'src/utilities/stringToSlug';
import { Card } from '@design-system/components/Card';
import { Heading } from '@design-system/elements/Heading';
import { MediaBlock } from '@design-system/components/MediaBlock';

export async function getStaticPaths() {
	const collection = await getDataHome();
	return collection.map((page: PageHomeProps) => ({
		params: {
			locale: page.localeID,
		},
		props: {
			pagesData: collection,
			locale: availableLocales.filter(
				(locale) => locale.id === page.localeID,
			)[0],
		},
	}));
}

interface Props {
	locale: Locale;
	pagesData?: PageHomeProps[];
}

const { locale, pagesData } = Astro.props;

// Get pagedata based on locale
const pageData: PageHomeProps = pagesData.filter(
	(page) => page.localeID === locale.id,
)[0];
console.log(pageData.currentAdvice.adviceNo);
---

<Layout
	locale={locale}
	metaData={pageData.metaData}
	skipPageSuffix
	mastheadHighlight
	alternativeTranslations={pageData.alternatives}
>
	<Hero
		title={pageData.hero.title}
		chapeau={pageData.hero.chapeau}
		image={pageData.hero.image}
		highlight
	>
		<ContentBlock value={pageData.hero.content} />
		<Button
			iconPosition="trailing"
			variant={pageData.button.variant}
			icon={pageData.button.icon}
			interactionIconAnimation="swing"
			href={pageData.button.href
				? prefixUrlWithlocale(`/${pageData.button.href}`, locale)
				: `#${stringToSlug(pageData.important.title)}`}
		>
			{pageData.button.label}
		</Button>
	</Hero>

	<Layer
		pullUpBy="hero"
		background="ijsblauw"
		id={stringToSlug(pageData.currentAdvice.title)}
	>
		<Retain>
			<Stack gap="huge">
				<SectionHeadingGroup title={pageData.currentAdvice.title}>
					<ContentBlock value={pageData.currentAdvice.adviceYes.content} />
				</SectionHeadingGroup>
				<GridFluid class="grid-important">
					<Card variant="white">
						<Stack gap="small">
							<Stack gap="small">
								<MediaBlock
									title={pageData.currentAdvice.adviceYes.title}
									icon={pageData.currentAdvice.adviceYes.image}
								/>
								<ContentBlock
									value={pageData.currentAdvice.adviceYes.content}
								/>
							</Stack>
							<Stack gap="large">
								{
									pageData.currentAdvice.adviceYes.items.map((item) => (
										<MediaBlock icon={item.image}>
											<ContentBlock value={item.content} />
										</MediaBlock>
									))
								}
							</Stack>
						</Stack>
					</Card>
					<Card variant="white">
						<Stack gap="small">
							<Stack gap="small">
								<MediaBlock
									title={pageData.currentAdvice.adviceNo.title}
									icon={pageData.currentAdvice.adviceNo.image}
								/>
								<ContentBlock value={pageData.currentAdvice.adviceNo.content} />
							</Stack>
							<Stack gap="large">
								{
									pageData.currentAdvice.adviceNo.items.map((item) => (
										<MediaBlock icon={item.image}>
											<ContentBlock value={item.content} />
										</MediaBlock>
									))
								}
								<Button
									variant={pageData.currentAdvice.adviceNo.button.variant}
									href={prefixUrlWithlocale(
										`/${pageData.currentAdvice.adviceNo.button.href}`,
										locale,
									)}
									icon={pageData.currentAdvice.adviceNo.button.icon}
									interactionIconAnimation="swing"
								>
									{pageData.currentAdvice.adviceNo.button.label}
								</Button>
							</Stack>
						</Stack>
					</Card>
				</GridFluid>
			</Stack>
		</Retain>
	</Layer>

	<Layer id={stringToSlug(pageData.important.title)}>
		<Retain>
			<Stack gap="huge">
				<SectionHeadingGroup
					title={pageData.important.title}
					icon={pageData.important.icon}
				>
					<ContentBlock value={pageData.important.content} />
				</SectionHeadingGroup>
				<GridFluid class="grid-important">
					{
						pageData.important.questionCollection
							?.filter((item) => item.label)
							.map((item) => (
								<Button
									variant="tertiary"
									href={prefixUrlWithlocale(item.href, locale)}
									icon="chevron-small-right"
									interactionIconAnimation="swing"
								>
									<ContentBlock value={item.label} />
								</Button>
							))
					}
				</GridFluid>
			</Stack>
		</Retain>
	</Layer>
</Layout>

<!-- Assistance block.
		TO DO:
		- assistannce block
	-->

<!-- {
		pageData.assistance && (
			<Layer id={stringToSlug(pageData.assistance.headline)}>
				<Retain>
					<Assistance feedback {...pageData.assistance} />
				</Retain>
			</Layer>
		)
	} -->

<style lang="scss">
	@use '@design-system-styles/primitives/_responsive.scss';

	.grid-important {
		--grid-fluid-min-item-size: 20rem; // 400px
		--grid-fluid-gap: var(--stack-small);
	}
</style>
