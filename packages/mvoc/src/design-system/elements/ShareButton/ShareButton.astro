---
import { Button } from '@mvoc/ui/elements';

interface Props {
	url: string;
	message: string;
	copy: { label: string; labelCopied: string };
}

const { url, message, copy } = Astro.props;
---

<Button
	variant="secondary"
	data-module="share"
	data-share-message={message}
	data-share-url={url}
	data-copy-label={copy.label}
	data-copy-copied={copy.labelCopied}
>
	<slot />
</Button>

<script>
	const shareButton = document.querySelector('[data-module="share"]');

	if (shareButton) {
		const message = shareButton.getAttribute('data-share-message') || '';
		const url = shareButton.getAttribute('data-share-url') || '';
		if ('share' in window.navigator) {
			shareButton.addEventListener('click', () => {
				window.navigator
					.share({
						title: message,
						url: url,
					})
					.catch(() => {
						return;
					});
			});
		} else if ('clipboard' in window.navigator) {
			const label = shareButton.getAttribute('data-copy-label') || '';
			const copied = shareButton.getAttribute('data-copy-copied') || '';
			const buttonContent = shareButton.querySelector('[data-button-content]');
			if (buttonContent) buttonContent.innerHTML = label;

			shareButton.addEventListener('click', () => {
				navigator.clipboard.writeText(url).then(() => {
					if (buttonContent) buttonContent.innerHTML = copied;
				});
			});
		} else {
			shareButton.remove();
		}
	}
</script>
