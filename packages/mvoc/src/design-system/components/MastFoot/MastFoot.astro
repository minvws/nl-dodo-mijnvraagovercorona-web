---
import Sprite from 'astro-icon';
import { Heading } from '@design-system/elements/Heading';
import { ContentBlock } from '@design-system/components/ContentBlock';
import {
	SiteSettingsProps,
	useSiteSettings,
} from 'src/utilities/api/queries/translated';
import { Locale, prefixUrlWithlocale } from 'src/utilities/locale/translation';
import { Layer } from '@design-system/components/Layout/Layer';
import { Retain } from '@design-system/components/Layout/Retain';
import { Stack } from '@design-system/components/Layout/Stack';
import { LinkList } from '@design-system/components/Lists';
import { GridFluid } from '../Layout/Grid';
import {
	LocaleSelectorList,
	AlternativeTranslationsProps,
} from '../LocaleSelector';

interface Props {
	locale: Locale;
	alternativeTranslations?: AlternativeTranslationsProps[];
}

const { locale, alternativeTranslations } = Astro.props;
const siteSettingsTranslated: SiteSettingsProps = await useSiteSettings({
	locale,
});
---

<footer class="c-mastfoot" role="contentinfo">
	<Retain>
		<div class="c-mastfoot__wrap-logo">
			<a class="c-mastfoot__logo" href={locale.urlPrefix}>
				<Sprite
					class="c-mastfoot__logo-visual"
					name="logo-vws"
					optimize={true}
				/>
				<span class="u-visually-hidden">{siteSettingsTranslated.logo.alt}</span>
			</a>
		</div>
	</Retain>
	<Layer as="div" class="c-mastfoot__layer">
		<Retain>
			<Heading class="u-visually-hidden">
				{siteSettingsTranslated.mastfoot.title}
			</Heading>
			<GridFluid class="c-mastfoot__grid">
				{
					siteSettingsTranslated.mastfoot.columns.map((column) => (
						<Stack gap="small">
							<Heading level={3}>{column.title}</Heading>
							{column.content ? <ContentBlock value={column.content} /> : null}
							{column.internalPageCollection ? (
								<LinkList
									links={column.internalPageCollection.map((item) => ({
										label: item.link.label,
										href: prefixUrlWithlocale(item.link.slug, locale),
									}))}
								/>
							) : null}
						</Stack>
					))
				}
			</GridFluid>
		</Retain>
	</Layer>

	<Layer as="div" class="c-mastfoot__layer-locale | u-hidden@large-until">
		<Retain>
			<LocaleSelectorList
				class="c-mastfoot__locale-selector"
				alternativeTranslations={alternativeTranslations}
			/>
		</Retain>
	</Layer>
</footer>

<style lang="scss">
	@use '@design-system-styles/primitives/_responsive.scss';

	.c-mastfoot {
		background-color: var(--color-ijsblauw);

		:global(h2),
		:global(h3) {
			color: currentColor;
		}
	}

	.c-mastfoot__layer {
		--layer-padding-block-start: var(--stack-giant);

		@media --mq-large {
			--layer-padding-block-start: var(--stack-huge);
		}
	}

	.c-mastfoot__grid {
		--grid-fluid-min-item-size: 15.1rem; // 302px
		--grid-fluid-gap: var(--stack-giant);

		@media --mq-large {
			--grid-fluid-gap: var(--stack-humongous);
		}
	}

	// Logo
	.c-mastfoot__wrap-logo {
		display: grid;
		grid-template-columns: 1fr 1fr;
	}

	/**
	 * 1. The banner width is a percentage of the whole image, we need to pull the
	 *    banner in the center.
	 */
	.c-mastfoot__logo {
		--logo-banner-percentage: 19.15%; /* [1] */
		grid-column-start: 2;
		justify-self: start;
		inline-size: 100%;
		max-inline-size: 9.65rem; // 193px
		transform: translateX(
			calc(var(--logo-banner-percentage) / 2 * -1)
		); /* [1] */

		&:focus {
			outline: var(--elevation-focusring);
			outline-offset: 2px;
		}
	}

	.c-mastfoot__logo-visual {
		display: block;
		inline-size: 100%;
	}

	// Locale selector
	.c-mastfoot__layer-locale {
		--layer-padding: var(--stack-large);
		background-color: var(--color-white);
	}

	.c-mastfoot__locale-selector {
		:global(> * + *) {
			margin-block-start: var(--stack-base);
		}

		:global(ul) {
			display: flex;
			flex-flow: row wrap;
			gap: var(--stack-small);

			:global(a) {
				--link-text-decoration: none;
				display: block;
				padding-block: 0.5rem;
				padding-inline: 1rem;
				border: 1px solid var(--color-donkerblauw);

				&[aria-current] {
					font-weight: bold;
					background-color: var(--color-poolblauw);
				}

				&:hover {
					--link-color: var(--color-black);
					background-color: var(--color-lichtblauw);
				}
			}
		}
	}
</style>
