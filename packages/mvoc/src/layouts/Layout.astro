---
import 'dotenv-flow/config';
import { Sprite } from 'astro-icon';
import MetaData from 'src/components/MetaData.astro';
import { MetaDataProps } from 'src/utilities/api/queries';
import {
	SiteSettingsProps,
	useSiteSettings,
} from 'src/utilities/api/queries/translated';
import { Locale } from 'src/utilities/locale/translation';

import '@design-system/globals.scss';
import { Masthead, SkipLink } from '@design-system/components/Masthead';
import {
	AlternativeTranslationsProps,
	LocaleSelector,
} from '@design-system/components/LocaleSelector';
import { MastFoot } from '@design-system/components/MastFoot';

export interface Props {
	type?: string;
	locale: Locale;
	alternativeTranslations?: AlternativeTranslationsProps[];
	metaData: MetaDataProps;
	skipPageSuffix?: boolean;
	mastheadHighlight?: boolean;
	disableMasthead?: boolean;
	disableMastfoot?: boolean;
}

const {
	type,
	locale,
	metaData,
	skipPageSuffix,
	mastheadHighlight,
	alternativeTranslations,
	disableMasthead,
	disableMastfoot,
} = Astro.props;
const siteSettings: SiteSettingsProps = await useSiteSettings({ locale });
---

<!DOCTYPE html>
<html lang={locale.id} dir={locale.direction} data-page-type={type}>
	<head>
		<MetaData
			{...metaData}
			locale={locale}
			skipPageSuffix={skipPageSuffix}
			alternativeTranslations={alternativeTranslations}
		/>
		<style lang="scss" is:global>
			:where(body) {
				display: flex;
				flex-direction: column;
			}
			:where(main) {
				flex: 1;
			}
		</style>
	</head>
	<body>
		<Sprite.Provider>
			<SkipLink label={siteSettings.masthead.skiplink} />
			{
				!disableMasthead ? (
					<Masthead
						logoUrl={locale.urlPrefix}
						logoAlt={siteSettings.logo.alt}
						highlight={mastheadHighlight}
					>
						<slot name="back" slot="start" />
						<LocaleSelector
							slot="end"
							alternativeTranslations={alternativeTranslations}
						/>
					</Masthead>
				) : null
			}
			<main id="content">
				<slot />
			</main>

			{!disableMastfoot ? <MastFoot locale={locale} /> : null}
		</Sprite.Provider>

		<script src="/scripts/piwik.js" is:inline defer></script>
		<noscript>
			<iframe
				src="//statistiek.rijksoverheid.nl/containers/c754ca66-1c06-4247-ac2d-3b4efb60dcac/noscript.html"
				height="0"
				width="0"
				style={{ border: '0', display: 'none', visibility: 'hidden' }}></iframe>
		</noscript>
		<script>
			import debounce from 'src/utilities/helpers/debounce';

			const checkSize = () => {
				const scrollbarWidth =
					window.innerWidth - document.documentElement.clientWidth;
				document.documentElement.style.setProperty(
					'--scrollbar__inline-size',
					`${scrollbarWidth}px`,
				);
			};

			window.addEventListener('resize', debounce(checkSize));

			checkSize();
		</script>
	</body>
</html>
