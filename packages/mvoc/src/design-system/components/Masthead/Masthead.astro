---
import { Sprite } from 'astro-icon';
import { Retain } from '../Layout/Retain';

type Props = {
	highlight?: boolean;
	logoUrl: string;
	logoAlt: string;
	forceCompact?: boolean;
};

const { highlight, logoUrl, logoAlt, forceCompact } = Astro.props;
---

<header
	class={`c-masthead${highlight ? ` c-masthead--highlight` : ''}${
		forceCompact ? ` c-masthead--compact` : ''
	}`}
	role="banner"
	data-module="masthead"
>
	<div>
		<slot name="start" />
	</div>
	<a class="c-masthead__logo" href={logoUrl}>
		<Sprite class="c-masthead__logo-visual" name="ro-logo" optimize={true} />
		<span class="u-visually-hidden">{logoAlt}</span>
	</a>
	<div class="c-masthead__end">
		<slot name="end" />
	</div>
</header>

<style lang="scss">
	@use '@design-system-styles/primitives/_responsive.scss';

	.c-masthead {
		--masthead-logo-block-size: 4rem; // 80px
		--masthead-background: var(--theme-bg-base);
		--masthead-inline-padding: var(--stack-base);
		position: relative;
		z-index: 50;
		display: grid;
		grid-template-columns: 1fr auto 1fr;
		align-items: center;
		gap: var(--space-r-small);
		padding-inline: var(--masthead-inline-padding);
		background-color: var(--masthead-background);

		@media --mq-large {
			& {
				--masthead-logo-block-size: 5.1rem; // 102px
			}
		}
	}
	.c-masthead__end {
		display: flex;
	}

	.c-masthead__logo {
		&:focus {
			outline: var(--elevation-focusring);
			outline-offset: 2px;
		}
	}
	.c-masthead__logo-visual {
		display: block;
		block-size: var(--masthead-logo-block-size);
		aspect-ratio: 54/81;
	}

	.c-masthead--highlight {
		--masthead-background: var(--theme-bg-highlight);
	}

	.c-masthead--compact {
		--masthead-logo-block-size: 4rem;
	}
</style>

<script>
	import debounce from 'src/utilities/helpers/debounce';

	// select dom nodes
	const masthead = document.querySelector('[data-module="masthead"]');

	if (masthead && !masthead.classList.contains('c-masthead--compact')) {
		const checkSize = () => {
			const mastheadRect = masthead.getBoundingClientRect();
			document.documentElement.style.setProperty(
				'--masthead__block-size',
				`${mastheadRect.height}px`,
			);
		};

		window.addEventListener('resize', debounce(checkSize));

		checkSize();
	}
</script>
