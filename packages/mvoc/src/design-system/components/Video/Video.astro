---
import { Icon } from '@design-system/elements/Icon';
import { HTMLAttributes } from 'astro/types';
import { ImageProps } from 'src/utilities/api/queries';
import { SiteSettingsProps, useSiteSettings } from 'src/utilities/api/queries';
import { getLocaleFromURL } from 'src/utilities/locale/translation';
import { PictureProps } from '../Picture';
import { getVideoEmbedUrl } from 'src/utilities/helpers/video';

interface Props extends HTMLAttributes<'div'> {
	title: string;
	url: string;
	image?: ImageProps;
	picture?: PictureProps;
}

const { class: className, title, url, picture, image, ...attrs } = Astro.props;
const locale = getLocaleFromURL(Astro.url.pathname);
const siteSettings: SiteSettingsProps = await useSiteSettings({ locale });
const embedUrl = getVideoEmbedUrl({ url });
---

<>
	{
		embedUrl ? (
			<div class={`c-video${className ? ` | ${className}` : ''}`} {...attrs}>
				<a
					class="c-video__cover"
					href={url}
					data-embed={embedUrl}
					target="_blank"
					rel="noopener noreferrer"
				>
					<img
						class="c-video__image"
						src={image?.src ? image.src : picture.image.src}
						alt=""
						loading="lazy"
					/>
					<Icon class="c-video__icon" name="video" />
				</a>
				<template>
					<iframe class="c-video__frame" src={embedUrl} />
				</template>
			</div>
		) : null
	}
	<!-- <a
	href={url}
	class={`c-video${className ? ` | ${className}` : ''}`}
	{...attrs}
	target="_blank"
	rel="noopener noreferrer"
>
	{
		image ? (
			<img class="c-video__image" src={image.src} alt="" loading="lazy" />
		) : picture ? (
			<img
				class="c-video__picture"
				src={picture.image.src}
				alt=""
				loading="lazy"
			/>
		) : null
	}
	<Icon class="c-video__icon" name="video" />
	<span class="u-visually-hidden">
		{title}({siteSettings.accessibility.labelExternalLink})
	</span>
</a> -->
</>

<style lang="scss">
	@use '@design-system-styles/tools/_a11y.scss';

	.c-video {
		--_video-aspect-ratio: var(--video-aspect-ratio, 16/9);
		--_video-color: var(--video-color, var(--color-diepblauw));
		position: relative;
		display: block;
	}

	.c-video__cover {
		position: relative;
		display: block;
		color: var(--_video-color);

		&::after {
			position: absolute;
			inset-block: 0;
			inset-inline: 0;
			background-image: linear-gradient(
				180deg,
				rgba(0, 0, 0, 0.6) 0%,
				rgba(0, 0, 0, 0) 100%
			);
			content: '';
		}

		&:focus {
			@include a11y.focusring;
		}

		&:hover,
		&:focus {
			--_video-color: var(--color-accent-robijnrood);
		}
	}

	.c-video__frame,
	.c-video__image {
		display: block;
		inline-size: 100%;
		block-size: auto;
		aspect-ratio: var(--_video-aspect-ratio);
	}

	.c-video__image {
		object-fit: cover;
	}

	.c-video__icon.c-video__icon {
		--icon-size: var(--space-16);
		position: absolute;
		inset: 50% 50%;
		translate: -50% -50%;
		z-index: 1;
	}
</style>
