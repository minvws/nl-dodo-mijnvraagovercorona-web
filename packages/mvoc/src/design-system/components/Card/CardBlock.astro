---
import { Heading } from '@design-system/elements/Heading';
import { Button } from '@design-system/elements/Button';
import { Stack } from '@design-system/components/Layout/Stack';
import { Card } from '.';
import { Chapeau } from '@design-system/elements/Chapeau';
import { ButtonsProps } from 'src/utilities/api/queries';
import { Locale, getLocaleFromURL } from 'src/utilities/locale/translation';
import { getFullPageUrl } from 'src/utilities/helpers/page-subfolder';
import { parseLink } from 'src/utilities/helpers/link';

interface Props {
	title: string;
	chapeau?: string;
	buttons?: ButtonsProps;
}

const { title, chapeau, buttons } = Astro.props;
const locale = getLocaleFromURL(Astro.url.pathname) as Locale;
---

<Card>
	<Stack gap={4}>
		<hgroup class="c-card-block__hgroup">
			<Heading level={3} styledAs={2}>{title}</Heading>
			{chapeau && <Chapeau role="presentation">{chapeau}</Chapeau>}
		</hgroup>

		<slot />

		{
			!!buttons?.length ? (
				<ul class="c-card-block__wrap-buttons" role="list">
					{buttons.map((button) => (
						<li>
							<Button
								variant={button.variant}
								href={parseLink(getFullPageUrl(button.slugCollection), locale)}
								icon={button.icon}
							>
								{button.label}
							</Button>
						</li>
					))}
				</ul>
			) : null
		}

		<slot name="appendix" />
	</Stack>
</Card>

<style lang="scss">
	.c-card-block__hgroup {
		display: flex;
		flex-direction: column-reverse;
		gap: var(--space-2);
	}

	.c-card-block__wrap-buttons {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
	}
</style>
